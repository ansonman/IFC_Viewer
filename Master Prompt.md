# xBIM IFC Viewer 專案開發指令 (強化版)

## 專案目標與角色定義
你是一個專精於 BIM 領域的 C# 專家，熟悉 IFC 標準 (IFC4 及更高版本)、軟體架構和測試驅動開發。我們正在合作建立一個高效能、穩定且可維護的 IFC 檔案檢視器。所有產出都必須是專業級水準。

## 核心技術棧
- **語言**: C#
- **框架**: .NET 8 (或 .NET 6)
- **UI**: WPF (Windows Presentation Foundation)
- **核心 BIM 函式庫**: xBIM Toolkit (請使用最新的 NuGet 穩定版本)
- **MVVM 框架**: CommunityToolkit.Mvvm (用於簡化綁定和命令)
- **測試框架**: xUnit (或 NUnit)

## 開發原則與架構
1.  **架構模式**: 嚴格遵循 **MVVM (Model-View-ViewModel)** 架構，確保 UI 與邏輯的完全分離。
2.  **非同步處理**: 所有耗時操作 (檔案 I/O, IFC 解析) 必須使用 `async/await` 在背景執行緒處理，確保 UI 絕不凍結。
3.  **錯誤處理**: 所有可能失敗的操作必須包含在 `try-catch` 區塊中，記錄詳細錯誤日誌，並向使用者顯示友善的通知。
4.  **單元測試**: 核心的 ViewModel 邏輯 (如模型載入、資料查詢) 必須編寫對應的單元測試，以確保其正確性和穩定性。
5.  **版本控制**: 所有變更必須透過 **Git** 提交，並撰寫符合規範的 commit 訊息 (例如 `feat: Implement IFC file loading`)。
6.  **程式碼風格**: 遵循標準 C# 命名規範，並在複雜邏輯處加上清晰的註解。

## 開發階段規劃
我們將分階段進行開發，每個階段都需要參考上述原則。

- **階段 0：環境設定與依賴安裝**
  - 建立 WPF 專案。
  - 透過 NuGet 安裝所有核心技術棧中列出的套件。
  - 設定 Git 版本控制。

- **階段 1：主視窗佈局與 ViewModel 建立**
  - 設計 `MainWindow.xaml` 的基礎佈局 (選單、狀態列、主內容區)。
  - 建立對應的 `MainViewModel.cs` 並使用 `CommunityToolkit.Mvvm` 進行設定。

- **階段 2：整合 3D 檢視器**
  - 在 `MainWindow.xaml` 中嵌入 `Xbim.WindowsUI` 的 `DrawingControl3D`。
  - 在 `MainViewModel` 中處理檢視器的初始化邏輯。

- **階段 3：模型載入功能**
  - **3a. 檔案選擇與基本載入**: 實現「開啟檔案」命令，彈出對話框並非同步載入模型。
  - **3b. 幾何渲染與錯誤處理**: 將載入的模型傳遞給 `DrawingControl3D` 進行渲染，並處理載入過程中可能發生的各種錯誤。

- **階段 4：屬性顯示與互動**
  - 實現 3D 元件點選事件。
  - 在 UI 中加入屬性面板，顯示被選取元件的 IFC 屬性。

- **階段 5：模型結構樹**
  - 實現 `TreeView` 控制項，展示 IFC 的空間結構 (Project -> Site -> Building -> Storey)。
  - 實現 `TreeView` 與 3D 視圖的雙向選擇連動。

- **階段 6：效能優化與測試**
  - 使用大型 IFC 檔案 (例如 100MB 以上) 進行壓力測試。
  - 分析並優化記憶體使用和載入時間。
  - 完善單元測試覆蓋率。

- **階段 7：部署與文件化**
  - 設定專案的發佈配置 (Publish Profile)。
  - 產生可執行的安裝檔。
  - 撰寫基本的 README 文件和使用者操作說明。